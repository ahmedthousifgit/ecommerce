<%-include('../partials/adminheader') %>

<body>
  <div class="screen-overlay"></div>
  <%-include('../partials/adminaside') %>
  <main class="main-wrap">
    <%-include('../partials/adminNav') %>
    <section class="content-main">
      <form
        action="/admin/add-product"
        method="post"
        enctype="multipart/form-data"
        
      >
        <div class="row">
          <div class="col-9">
            <div class="content-header">
              <h2 class="content-title">Add New Product</h2>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card mb-4">
              <div class="card-header">
                <h4>Basic</h4>
              </div>
              <div class="card-body">
                <div class="mb-4">
                  <label for="product_name" class="form-label">Product title</label>
                  <input
                    type="text"
                    placeholder="Type here"
                    class="form-control"
                    id="product_name"
                    name="name"
                    pattern="^[a-zA-Z\s]+$"
                    required
                  />
                  <small id="name-error" class="error-message"></small>
                </div>
            
                <div class="mb-4">
                  <label class="form-label">Full description</label>
                  <textarea
                    placeholder="Type here"
                    class="form-control"
                    rows="4"
                    name="description"
                  ></textarea>
                </div>
                
                <div class="row">
                 
                  <div class="row">
                    <div class="col-lg-4">
                      <div class="mb-4">
                        <label class="form-label">Sale price</label>
                        <input
                          placeholder="$"
                          type="number"
                          class="form-control"
                          name="salePrice"
                          id="salePrice"
                          min="0"
                          step="0.01" 
                          required
                        />
                        <small id="salePrice-error" class="error-message"></small>
                      </div>
                    </div>
                    
                    <div class="col-lg-4">
                      <label class="form-label">Unit</label>
                      <input
                        placeholder="$"
                        type="number"
                        class="form-control"
                        name="units"
                        min="0"
                        required
                      />
                      <small id="units-error" class="error-message"></small>
                    </div>
                  </div>
                </div>
                <div class="mb-4">
                  <label class="form-label">Tax rate</label>
                  <input
                    type="text"
                    placeholder="%"
                    class="form-control"
                    name="taxRate"
                  />
                </div>

                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    style="background-color: red; border-color: red"
                    name="color"
                    id="inlineRadio2"
                    value="red"
                    checked
                  />
                  <label class="form-check-label" for="inlineRadio2">Red</label>
                </div>

                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    style="background-color: white; border-color: white"
                    name="color"
                    id="inlineRadio2"
                    value="white"
                  />
                  <label class="form-check-label" for="inlineRadio2"
                    >white</label
                  >
                </div>

                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    style="background-color: brown; border-color: brown"
                    name="color"
                    id="inlineRadio2"
                    value="Brown"
                  />
                  <label class="form-check-label" for="inlineRadio2"
                    >Brown</label
                  >
                </div>

                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    style="background-color: black; border-color: black"
                    name="color"
                    id="inlineRadio2"
                    value="black"
                  />
                  <label class="form-check-label" for="inlineRadio2"
                    >Black</label
                  >
                </div>

                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    style="background-color: Blue; border-color: Blue"
                    name="color"
                    id="inlineRadio2"
                    value="Blue"
                  />
                  <label class="form-check-label" for="inlineRadio2"
                    >Blue</label
                  >
                </div>

                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    style="background-color: Orange; border-color: Orange"
                    name="color"
                    id="inlineRadio2"
                    value="Orange"
                  />
                  <label class="form-check-label" for="inlineRadio2"
                    >Orange</label
                  >
                </div>

                <!-- Other form fields for product details -->
                <div class="d-flex justify-content-end">
                  <button
                    type="submit"
                    class="btn btn-md rounded font-sm col-lg-4 hover-up"
                  >
                    Add product
                  </button>
                </div>
              </div>
            </div>
            <!-- card end// -->
          </div>

          <!-- Media card -->
          <div class="col-lg-3" >
          
              <div class="card mb-4" style="width: 25rem ;">
                <div class="card-header">
                    <h4>Picture</h4>
                </div>
                <div class="card-body" >
                    
                    <div class="card mb-4">
                        <!-- <div class="card-body">
                            
                            <div class="images-container">
                                <div class="image-preview-container d-flex flex-wrap justify-content-center">
                                   
                                    <div class="image-container border-1">
                                        <img style="width: 100px; height: 100px; margin-bottom: 20px;" src="/assets/imgs/theme/upload.svg" alt="Default" class="image-preview">
                                    </div>
                                </div>
                                <input class="form-control" name="image"  multiple="multiple" type="file" onchange="displayImages(this)">
                                <div class="error-message" style="color: red;" id="product_image-error"></div>
                            </div>
                            
                            <script>
                                function displayImages(input) {
                                    const previewContainer = document.querySelector('.image-preview-container');
                                    previewContainer.innerHTML = ''; // Clear previous previews
                            
                                    if (input.files && input.files.length > 0) {
                                        for (let i = 0; i < input.files.length; i++) {
                                            const reader = new FileReader();
                                            reader.onload = function (e) {
                                               console.log(e.target.result,"kkkk");  
                                              const imagePreview = document.createElement('div');
                                                imagePreview.classList.add('image-container');
                                                const img = document.createElement('img');
                                                img.src = e.target.result;
                                                img.style.width = '100px';
                                                img.style.height = '100px';
                                                img.style.marginBottom = '20px';
                                                img.style.marginRight = '5px'; 
                                                img.style.marginLeft = '5px'; 
                                                img.classList.add('image-preview');
                                                imagePreview.appendChild(img);
                                                previewContainer.appendChild(imagePreview);
                                            };
                                          
                                            reader.readAsDataURL(input.files[i]);
                                        }
                                    } else {
                                        const defaultImagePreview = document.createElement('div');
                                        defaultImagePreview.classList.add('image-container');
                                        const defaultImg = document.createElement('img');
                                        defaultImg.src = '/uploadimage.svg';
                                        defaultImg.style.width = '100px';
                                        defaultImg.style.height = '100px';
                                        defaultImg.style.marginBottom = '20px';
                                        defaultImg.style.marginRight = '5px'; 
                                        defaultImg.style.marginLeft = '5px'; 
                                        defaultImg.classList.add('image-preview');
                                        defaultImagePreview.appendChild(defaultImg);
                                        previewContainer.appendChild(defaultImagePreview);
                                    }
                                    
                                }
                            </script>
                        </div> -->
                        <center>
                          <p style="color: red; margin-top: 10px;" id="err14"></p>
                          <input type="file" name="imageData" id="poster" accept="image/*" required>
                          <button type="button" class="btn btn-md rounded font-sm hover-up"
                              onclick="loadImage('poster')">Crop</button>
                          <img src="" id="showposter" style="width: auto; height: 250px; margin-top: 20px ; display: block;"
                              alt="">
      
                          <button style="display: none;" class="btn btn-warning p-2 px-5 border-2 mt-2" type="button"
                              id="saveposter" onclick="uploadCroppedImage('poster')">Save</button>
      
                          <button style="display: none;" class="btn btn-danger p-2 px-5 border-2 mt-2" type="button"
                              id="cancelposter">Cancel</button>
      
      
                          <label for="Images" style="float: left; margin-left: 1rem;">Images</label>
      
                          <p style="color: red; margin-top: 10px;" id="err15">.</p>
                          <input type="file" name="imageData" style=" margin-top: 20px;" id="Img1" accept="image/*" required>
                          <button type="button" class="btn btn-md rounded font-sm hover-up"
                              onclick="loadImage('Img1')">Crop</button>
      
                          <img src="" id="showImg1" style="width: auto; height: 250px; margin-top: 20px;" alt="">
      
                          <button style="display: none;" class="btn btn-warning p-2 px-5 border-2 mt-2" type="button"
                              id="saveImg1" onclick="uploadCroppedImage('Img1')">Save</button>
      
                          <button style="display: none;" class="btn btn-danger p-2 px-5 border-2 mt-2" type="button"
                              id="cancelImg1">Cancel</button>
      
                          <p style="color: red; margin-top: 10px;" id="err16"></p>
                          <input type="file" name="imageData" style=" margin-top: 20px;" id="Img2" accept="image/*" required>
                          <button type="button" class="btn btn-md rounded font-sm hover-up"
                              onclick="loadImage('Img2')">Crop</button>
      
                          <img src="" id="showImg2" style="width: auto; height: 250px; margin-top: 20px;" alt="">
      
                          <button style="display: none;" class="btn btn-warning p-2 px-5 border-2 mt-2" type="button"
                              id="saveImg2" onclick="uploadCroppedImage('Img2')">Save</button>
      
                          <button style="display: none;" class="btn btn-danger p-2 px-5 border-2 mt-2" type="button"
                              id="cancelImg2">Cancel</button>
      
                          <p style="color: red; margin-top: 10px;" id="err17"></p>
                          <input type="file" name="imageData" id="Img3" style=" margin-top: 20px;" accept="image/*" required>
                          <button type="button" class="btn btn-md rounded font-sm hover-up"
                              onclick="loadImage('Img3')">Crop</button>
      
                          <img src="" id="showImg3" style="width: auto; height: 250px; margin-top: 20px;" alt="">
      
                          <button style="display: none;" class="btn btn-warning p-2 px-5 border-2 mt-2" type="button"
                              id="saveImg1" onclick="uploadCroppedImage('Img3')">Save</button>
      
                          <button style="display: none;" class="btn btn-danger p-2 px-5 border-2 mt-2" type="button"
                              id="cancelImg3">Cancel</button>
      
  
                      </center>

                    </div>
                </div>
            </div> 

            <div class="card mb-4">
              <div class="card-header">
                <h4>Organization</h4>
              </div>
              <div class="card-body">
                <div class="row gx-2">
                  <div class="col-sm-6 mb-3">
                    <label class="form-label">Category</label>
                    <select class="form-select" name="category">
                      <% categories.forEach(category => { %>
                      <option value="<%= category.name %>">
                        <%= category.name %>
                      </option>
                      <% }); %>
                    </select>
                  </div>
                  <div class="col-sm-6 mb-3">
                    <label class="form-label">Sub-category</label>
                    <select class="form-select" name="subCategory">
                      <option value="men">Men</option>
                      <option value="women">Women</option>
                      <option value="kids">Kids</option>
                    </select>
                  </div>
                </div>
                <!-- row.// -->
              </div>
            </div>

            </div>
            <!-- card end// -->
            
          </div>
        </div>
        
        
        
        
        
        
      </form>
      <script>
        document.getElementById('admin-login-form').addEventListener('submit', function (event) {
            // ... (existing validation logic) ...
  
            // Validate product title (allow only alphabetical characters)
            var nameInput = document.getElementsByName('name')[0];
            var nameError = document.getElementById('name-error');
            if (!/^[a-zA-Z\s]+$/.test(nameInput.value)) {
                event.preventDefault();
                nameInput.setCustomValidity('Only alphabetical characters are allowed.');
                nameError.textContent = 'Only alphabetical characters are allowed.';
                nameError.style.color = 'red';
            } else {
                nameInput.setCustomValidity('');
                nameError.textContent = '';
            }
  
            // Validate sale price (non-negative number with up to two decimal places)
            var salePriceInput = document.getElementsByName('salePrice')[0];
            var salePriceError = document.getElementById('salePrice-error');
            if (parseFloat(salePriceInput.value) < 0 || !/^\d+(\.\d{1,2})?$/.test(salePriceInput.value)) {
                event.preventDefault();
                salePriceInput.setCustomValidity('Invalid sale price. Please enter a non-negative number.');
                salePriceError.textContent = 'Invalid sale price. Please enter a non-negative number.';
                salePriceError.style.color = 'red';
            } else {
                salePriceInput.setCustomValidity('');
                salePriceError.textContent = '';
            }
  
            // Validate units (non-negative integer)
            var unitsInput = document.getElementsByName('units')[0];
            var unitsError = document.getElementById('units-error');
            if (parseInt(unitsInput.value) < 0 || !/^\d+$/.test(unitsInput.value)) {
                event.preventDefault();
                unitsInput.setCustomValidity('Invalid units value. Please enter a non-negative integer.');
                unitsError.textContent = 'Invalid units value. Please enter a non-negative integer.';
                unitsError.style.color = 'red';
            } else {
                unitsInput.setCustomValidity('');
                unitsError.textContent = '';
            }
  
            // Validate image file format
            var imageInput = document.getElementsByName('image')[0];
            var imageError = document.getElementById('image-error');
            if (imageInput.files.length > 0) {
                var allowedFormats = ['.jpg', '.jpeg', '.webp', '.png', '.gif'];
                var fileName = imageInput.files[0].name;
                var fileExtension = fileName.substring(fileName.lastIndexOf('.')).toLowerCase();
                if (!allowedFormats.includes(fileExtension)) {
                    event.preventDefault();
                    imageInput.setCustomValidity('Invalid image file format. Allowed formats: ' + allowedFormats.join(', '));
                    imageError.textContent = 'Invalid image file format. Allowed formats: ' + allowedFormats.join(', ');
                    imageError.style.color = 'red';
                } else {
                    imageInput.setCustomValidity('');
                    imageError.textContent = '';
                }
            }
        });
      </script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
        <script>
          let cropper;

const updateProductForm = document.getElementById('updateProductForm');
updateProductForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    let result = await Swal.fire({
        title: 'Do you want to save the changes?',
        showDenyButton: true,
        showCancelButton: true,
        confirmButtonText: 'Save',
        denyButtonText: "Don't save",
    });
    if (result.isConfirmed) {
        await Swal.fire('Saved!', '', 'success');
        updateProductForm.submit();
    } else if (result.isDenied) {
        await Swal.fire('Changes are not saved', '', 'info');
    }
});




function loadImage(id) {

const input = document.getElementById(id);

const canvas = document.getElementById(`show${id}`);

const file = input.files[0];
console.log(file)

if (file) {
    const reader = new FileReader();

    reader.onload = function (e) {
        canvas.src = e.target.result;
        document.getElementById(`save${id}`).style.display = 'block'
        document.getElementById(`cancel${id}`).style.display = 'block'
        if (cropper) {
            cropper.destroy();
        }

        cropper = new Cropper(canvas, {
            viewMode: 2,
        });
    };

    reader.readAsDataURL(file);
} else {
    canvas.src = '';
    if (cropper) {
        cropper.destroy();
    }
}
}

function uploadCroppedImage(id) {
const canvas = cropper.getCroppedCanvas();

if (canvas) {
    canvas.toBlob((blob) => {
        const fileName = 'cropped_image.jpg';
        const file = new File([blob], fileName, { type: 'image/jpeg' });
        const input = document.getElementById(id);

        if (DataTransfer && FileList) {
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            input.files = dataTransfer.files;
        } else {
            console.error('FileList and DataTransfer are not supported in this browser.');
        }

        const showImg = document.getElementById(`show${id}`);
        showImg.src = URL.createObjectURL(blob);

        cropper.destroy();
        document.getElementById(`save${id}`).style.display = 'none';
        document.getElementById(`cancel${id}`).style.display = 'none';
    });
}
}
        </script>
    </section>
   
    

    <%-include('../partials/adminfooter') %>
  </main>
</body>
